# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- azure-pipelines

strategy:
  matrix:
    linux:
      imageName: 'ubuntu-latest'
    mac:
      imageName: 'macos-10.14'
    windows:
      imageName: 'windows-2019'

pool:
  vmImage: $(imageName)

jobs:
- job: 'Build and test'
  steps:
  - pwsh: |
      Install-Module Psake -Force -SkipPublisherCheck
      Invoke-Psake -Tasklist BuildTools, Compile -nologo
    displayName: Build project

  - pwsh: |
      Invoke-Psake -Tasklist Test -nologo
      exit ([int](-not $psake.build_success))
    displayName: test project

- job: 'Publish artifact'
  steps:
  - task: PublishBuildArtifacts@1
    enabled: false
    dependsOn: 'Build and test'
    condition: and(succeeded(), eq(variables['Agent.OS'], 'Windows_NT'))
    inputs:
      PathtoPublish: '$(System.DefaultWorkingDirectory)\publish\Okta'
      ArtifactName: 'drop'
      publishLocation: 'Container'